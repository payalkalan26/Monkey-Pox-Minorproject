{% extends "base.html" %}

{% block title %}Monkeypox Detection{% endblock %}

{% block content %}
<div class="row justify-content-center animate-on-scroll">
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header text-center py-4">
                <h2 class="mb-0"><i class="fas fa-search-plus me-2"></i>Monkeypox Detection</h2>
                <p class="mb-0">Upload an image of the affected area for analysis</p>
            </div>
            <div class="card-body p-4 p-md-5">
                <div class="text-center mb-5">
                    <div class="upload-area" id="dropArea">
                        <i class="fas fa-cloud-upload-alt fa-3x mb-3" style="color: var(--primary-color);"></i>
                        <h4>Drag & Drop your image here</h4>
                        <p class="text-muted">or</p>
                        <input type="file" name="file" id="fileInput" accept="image/*" class="d-none" required>
                        <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-folder-open me-2"></i>Browse Files
                        </button>
                        <p class="mt-3 mb-0 text-muted small" id="fileName">Supports JPG, PNG (Max 5MB)</p>
                    </div>
                </div>

                <form action="{{ url_for('detection') }}" method="post" enctype="multipart/form-data" id="uploadForm" class="text-center">
                    <input type="file" name="file" id="hiddenFileInput" class="d-none" required>
                    <button type="submit" class="btn btn-primary btn-lg px-5" id="analyzeBtn" disabled>
                        <i class="fas fa-search me-2"></i>Analyze Image
                    </button>
                </form>

                <div class="alert alert-info mt-4 text-start">
                    <h5 class="d-flex align-items-center">
                        <i class="fas fa-info-circle me-2"></i> Tips for Best Results
                    </h5>
                    <ul class="mb-0">
                        <li>Use good lighting when taking photos</li>
                        <li>Ensure the affected area is clearly visible</li>
                        <li>Upload high-quality images (JPG, PNG)</li>
                        <li>Avoid blurry or out-of-focus images</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row justify-content-center animate-on-scroll" style="animation-delay: 0.2s;">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body p-4">
                <h4 class="mb-4 text-center">
                    <i class="fas fa-virus me-2" style="color: var(--secondary-color);"></i> 
                    About Monkeypox
                </h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="fas fa-exclamation-triangle text-warning fa-2x"></i>
                            </div>
                            <div>
                                <h5>Symptoms</h5>
                                <p class="mb-0">Fever, headache, muscle aches, swollen lymph nodes, and a rash that often begins on the face and spreads to other parts of the body.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="fas fa-shield-alt text-primary fa-2x"></i>
                            </div>
                            <div>
                                <h5>Prevention</h5>
                                <p class="mb-0">Practice good hygiene, avoid contact with infected individuals, and wear protective equipment when caring for patients.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('precautions') }}" class="btn btn-outline-primary">
                        <i class="fas fa-shield-alt me-2"></i> Learn More About Prevention
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const dropArea = document.getElementById('dropArea');
    const fileInput = document.getElementById('fileInput');
    const hiddenFileInput = document.getElementById('hiddenFileInput');
    const fileName = document.getElementById('fileName');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const uploadForm = document.getElementById('uploadForm');

    // Handle drag and drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    // Highlight drop area when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
        dropArea.classList.add('border-primary', 'bg-light');
    }

    function unhighlight() {
        dropArea.classList.remove('border-primary', 'bg-light');
    }

    // Handle dropped files
    dropArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
    }

    // Handle file selection
    fileInput.addEventListener('change', function() {
        handleFiles(this.files);
    });

    function handleFiles(files) {
        if (files.length > 0) {
            const file = files[0];
            if (file.type.startsWith('image/')) {
                // Update UI
                fileName.textContent = file.name;
                analyzeBtn.disabled = false;
                
                // Update the hidden file input for form submission
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                hiddenFileInput.files = dataTransfer.files;
            } else {
                alert('Please select an image file (JPG, PNG)');
                fileInput.value = '';
                fileName.textContent = 'Supports JPG, PNG (Max 5MB)';
                analyzeBtn.disabled = true;
            }
        }
    }

    // Show loading state on form submission
    uploadForm.addEventListener('submit', function() {
        const btn = document.getElementById('analyzeBtn');
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Analyzing...';
    });
</script>
{% endblock %}